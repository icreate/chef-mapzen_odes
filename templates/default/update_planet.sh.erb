#!/usr/bin/env bash

# stagger runs
sleep $(expr $RANDOM % 300)

planet_file=<%= node[:mapzen_odes][:planet][:file] %>

echo "Starting run at $(date)."

echo "Running osmupdate."
osmupdate ${planet_file} updated-${planet_file}

echo "Running osmconvert."
osmconvert updated-${planet_file} -o=planet_osmconvert.o5m

echo "Moving updates into place."
mv -f updated-${planet_file} ${planet_file}
mv -f planet_osmconvert.o5m planet.o5m

echo "Finishing run at $(date)."
